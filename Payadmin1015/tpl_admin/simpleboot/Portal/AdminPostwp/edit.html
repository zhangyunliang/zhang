<admintpl file="header" />
<body class="J_scroll_fixed">
<div class="wrap J_check_wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a href="">尾货商品编辑</a></li>
    </ul>
    <div>基本信息</div>
    <form class="form-horizontal J_ajaxForm" name="myform" method="post" action="{:U('AdminPostwp/edit_post')}">
        <input type="hidden" name="goods_id" value="{$goods['goods_id']}"/>
        <div class="search_type cc mb10">
            <div class="mb10">
                <div class="form-actions" style="padding-left:40px;">商品选择区：<br />
                    <span class="mr20">*商品分类：
                         <select name="goods_cat_id" id="select_1">
                             <option value='-1' >--请选择--</option>
                             <foreach name="list1" item="vo">
                                 <php>$selected=$goods['goods_cat_id']==$vo['goods_category_id']?"selected":"";</php>
                                 <if condition="($vo.cat_id neq 0) or ($vo.grade eq 1)">
                                     <option value="{$vo.goods_category_id}" disabled="true" {$selected}>{$vo.goods_category_name}</option>
                                     <else/>
                                     <option value="{$vo.goods_category_id}" {$selected}>{$vo.goods_category_name}</option>
                                 </if>

                             </foreach>
                         </select>

                         &nbsp;&nbsp;&nbsp;&nbsp;*商品品牌：
                        <select name="brand_id" id="select_2">
                            <option value='-1' >--请选择--</option>
                            <foreach name="list2" item="vo">
                                <php>$selected=$goods['brand_id']==$vo['brand_id']?"selected":"";</php>
                                <option value="{$vo.brand_id}" {$selected}>{$vo.brand_name}</option>
                            </foreach>
                        </select>
                    </span><br /><br /><br />

                    <span class="mr20">*请选择颜色：</span>
                    <select name="color_id" >
                        <option value='-1' >--请选择--</option>
                        <foreach name="list3" item="vo">
                            <php>$selected=$goods['color_id']==$vo['color_id']?"selected":"";</php>
                            <option value="{$vo.color_id}" {$selected}>{$vo.color}</option>
                        </foreach>
                    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                    <span class="mr20">*请选择供应商：</span>
                    <select name="cms_suppliers_id" style="width:320px;">
                        <if condition="$goods['cms_suppliers_id'] eq 0">
                            <option value="0">暂无供应商</option>
                            <foreach name="list4" item="vo">
                                <php>$selected=$goods['cms_suppliers_id']==$vo['suppliers_id']?"selected":"";</php>
                                <option value="{$vo.suppliers_id}" {$selected}>{$vo.suppliers_name}</option>
                            </foreach>
                            <else/>
                            <option value='-1' >--请选择--</option>
                            <foreach name="list4" item="vo">
                                <php>$selected=$goods['cms_suppliers_id']==$vo['suppliers_id']?"selected":"";</php>
                                <option value="{$vo.suppliers_id}" {$selected}>{$vo.suppliers_name}</option>
                            </foreach>
                        </if>
                    </select><br /><br /><br />
                </div>
                <div class="form-actions" style="padding-left:40px;">商品填写区：<br />

                    <span class="mr20">*商品名称：</span>
                    <input type="text"  name="goods_name" value="{$goods['goods_name']}" id="inp"/>&nbsp;&nbsp;
                    <span class="mr20">*商品单位：</span>
                    <input type="text"  name="goods_unit" value="{$goods['goods_unit']}"/>&nbsp;&nbsp;
                    <!--需要判断-->
                    <span class="mr20">*商品型号：</span>
                    <input type="text" name="goods_version" value="{$goods['goods_version']}" id="inp_1"/><br /><br />

                    <span class="mr20">*公开价：</span>
                    <input type="text"  name="public_price" value="{$goods['public_price']}"/>&nbsp;&nbsp;
                    <span class="mr20">*会员价：</span>
                    <input type="text"  name="shop_price" value="{$goods['shop_price']}"/>&nbsp;&nbsp;
                    <span class="mr20">*内部价：</span>
                    <input type="text" name="private_price" value="{$goods['private_price']}"/>&nbsp;&nbsp;
                    <span class="mr20">*库存：</span>
                    <input type="text" name="stock" value="{$goods['stock']}"/>&nbsp;&nbsp;
                </div>
            </div>
        </div>
                    <!--这里为修改商品状态。假的删除商品-->
                    <input type="hidden" name="is_delete" value="{$goods['is_delete']}"/>
                    <input type="hidden" name="is_pass" value="{$goods['is_pass']}"/>

                    <input type="hidden" name="goodsnames" value="" id="gne"/>
                    <input type="hidden" name="getversions" value="" id="vers"/>
        <div class="form-actions" style="padding-left:20px;">
            <button class="btn btn-primary btn_submit J_ajax_submit_btn" type="submit">修改</button>

            <if condition="$goods['is_delete'] eq 1">
                <a class="btn btn-primary" href="{:U('AdminPostwp/back',array('bid'=>$goods['goods_id']))}">恢复该商品</a>
                <else/>
                <a class="btn btn-primary J_ajax_del" href="{:U('AdminPostwp/delete',array('gid'=>$goods['goods_id']))}">删除该商品</a>
            </if>

        </div>
    </form>


</div>
<script type="text/javascript" src="__ROOT__/statics/js/common.js"></script>
<script>
    /**
     * Created by yunliang on 2015/11/10.
     */
    $(function () {

        //商品分类点击后更改品牌
        $('#select_1').change(function(){
            //alert(1);
            var cat_id=$(this).val();
            $.ajax({
                type:'POST',
                dataType:'json',
                url:'__ROOT__/index.php?g=portal&m=AdminPostwp&a=getbrand',
                data:'goods_category_id='+$('#select_1').val(),

                success:function(msg){
                    if(msg!=null){
                        var option_str='';
                        for(var i=0;i<msg.length;i++){
                            option_str+="<option value="+msg[i].brand_id+">"+msg[i].brand_name+"</option>";
                        }
                        $('#select_2 option').remove();
                        $('#select_2').append(option_str);
                    }else {
                        $('#select_2 option').remove();
                        $('#select_2').append("<option value='0'>暂无品牌</option>");
                    }
                }
            })
        });

        //判断型号并且添加
        $('#inp_1').change(function(){
            //alert(1);
            var text=$(this).val();
            //alert(text);
            var id=$('#select_1 option:selected').val();
            //alert(id);
            $.ajax({
                type:'POST',
                dataType:'json',
                url:'__ROOT__/index.php?g=portal&m=AdminPostwp&a=pdversion',
                data:{"goodsid":id,"vs":text},

                success:function(msg){
                    //alert(msg);
                    if(msg=='0'){
                        //已有的型号
                        //console.log(msg.version_id);
                        $('#vers').val('1');
                    }
                }

            })
        });

        //判断商品名并添加
        $('#inp').change(function(){
            //alert();
            var name=$(this).val();
            var id=$('#select_1 option:selected').val();
            $.ajax({
                type:'POST',
                dataType:'json',
                url:'__ROOT__/index.php?g=portal&m=AdminPostwp&a=pdname',
                data:{"spname":name,"goodsid":id},

                success:function(msg){
                    if(msg=='0'){
                        //已有的商品名
                        // console.log(msg.goods_name_id);
                        $('#gne').val('1');
                    }
                }
            })
        });


    });

</script>
</body>
</html>

