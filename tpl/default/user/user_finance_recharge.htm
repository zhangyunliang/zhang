<!--{template header}--><!--contain start-->
<div class="wrapper">
 <div class="container_24">
  <!--{template user/user_nav}-->
<!--main start-->
 <section class="clearfix section">
  <!--{template user/user_side}-->
   <div class="show_panel container_24 po_re">
    <div class="prefix_3">
      <div class="panel clearfix box">
      <!--main content-->
      <div class="grid_21">
       <!--header内容头部 start-->
         <header class="clearfix box_header">
          <h2 class="grid_4 alpha box_title t_c">{$_lang['account_recharge']}</h2>
           <div class="fl_r">
             <button class="fl_l block" type="button" value={$_lang['i_want_to_recharge']} onclick="location.href='index.php?do=user&view=finance&op=recharge'" style="width:100px">
                                      {$_lang['i_want_to_recharge']}
             </button>
             <button class="fl_l block ml_5" type="button" value={$_lang['i_want_to_withdraw']} onclick="location.href='index.php?do=user&view=finance&op=withdraw'" style="width:100px">
                                        {$_lang['i_want_to_withdraw']}
             </button>
           </div>
           <div class="clear"></div>
         </header>
        <h2 class="bf7 pl_10">{$_lang['account_balance']}{$_lang['zh_mh']}
           <font color="red">
                                    {$_lang['currency']}{$user_info['balance']}
           </font>
		   {if $user_info['credit']>0.00}&nbsp;&nbsp;&nbsp;{$_lang['remain']}{CREDIT_NAME}{$_lang['zh_mh']}
           	<font color="red">$user_info['credit']</font>
		   {/if}
		        </h2>
		   <!--header内容头部 end-->
		 
		   <!--detail内容 start-->
		 <article class="box_detail">
		  <!--messages消息 start-->
		   <div class="messages m_infor clearfix">
		     <span class="icon16 fl_l">warning</span>
		         {$_lang['recharge_min_money']}:{$_lang['currency']}{$pay_arr['recharge_min']['v']}{$_lang['yuan']}{$_lang['zh_jh']} {$_lang['recharge_notice']}<a href="###" class="close">&times;</a>
		   </div>
		  <!--messages消息 end-->
		   <div class="prefix_1 suffix_1 clearfix">
		    <!--step步骤 start-->
		    <div class="step_progress clearfix">
		      {loop $step_list $k $v}
		        <div class="step {$k} {if $k==$step}selected{/if}">
		          <span class="icon32">{$k}</span>
		          <strong>{$v['0']}</strong>{$v['1']}
		        </div>
		      {/loop}
		    </div>
		    <!--step步骤 end-->
		  {if $step=='step1'}
		     <form name="frm_cash" id="frm_cash" method="post" action="$ac_url&step=step1&choose_cash=1" >
		     	<input type="hidden" name="cash" id="cash">
			  <div class="pad10  form_box">
		      <div class="prefix_1 suffix_1">
		       <div class="clearfix box font14">
		       
		         <div class="rowElem clearfix">
		          <label class="grid_4 t_r">{$_lang['input_recharge_money']}{$_lang['zh_mh']}</label>
				 
				  <div class="grid_8">
		            <input class="txt_input" type="text" name="recharge" id="recharge" value="{$cash}" size="30" limit="required:true;type:float;between:$pay_arr['recharge_min']['v']-99999999999" msg="{$_lang['recharge_money_notice']}{$pay_arr['recharge_min']['v']}{$_lang['yuan']}" title="{$_lang['recharge_money_notice']}{$pay_arr['recharge_min']['v']}{$_lang['yuan']}" msgArea="txt_cash_in_msg"/>
					<div class="clear"></div>
					<span id="txt_cash_in_msg"></span>
				  </div>
		         </div>
		  
		        </div>
		       </div>
		     </div>
		      <div class="rowElem clearfix t_c">
		       <button type="submit" value={$_lang['next_step']}  onclick="return next_step();" style="width:100px" >{$_lang['next_step']}</button>
		     </div>
			  </form>
			
		     {elseif $step=='step2'}
		     <div class="pad10  form_box">
		       <div class="form_tip ml_10 mr_10">
		        <p class="cf90 font14">{$_lang['you_input_money_is']}:<b class="cc33">{$cash}{$_lang['yuan']}</b></p>
		       </div>
			   
		       <form action="{$ac_url}&auth_step=step2&bank_id={$bank_id}" name="pay" id="pay" method="post">
		         <!--页面子导航-->
		            <nav class="clearfix page_nav po_re mt_10">
		                <ul>
		                <li class="selected" onclick="swaptab('cont','selected','',2,1)" id="tab_cont_1">
		                	<a href="javascript:void(0);"><span>{$_lang['online_pay']}</span></a>
						</li>
		                <li onclick="swaptab('cont','selected','',2,2)" id="tab_cont_2">
		                	<a href="javascript:void(0);"><span>{$_lang['offline_pay']}</span></a>
						</li>
		              </ul>
		              </nav>
		          <!--end 页面子导航--> 
				  <!--start 线上支付方式-->
		           <div class="suffix_1 online" id="div_cont_1">
		              <div class="mt_10 mb_10 font12 account1">
		                <fieldset>
		                   <legend>{$_lang['optional_account']}</legend>
		                    <!--{eval $k=0;}-->
							{loop $payment_list $pay}
		                       {if $pay['pay_status']}<!--{eval $k++;}-->
		                          <div class="grid_4">
		                              <input class="fl_l mt_10" type="radio" name="online" value="{$pay['payment']}" {if $k=='1'}checked="checked"{/if}/>
									  <label class="fl_l"><img class="ov_hide" style="width:110px;"  src="payment/{$pay['pay_dir']}/{$pay['img']}" align="absmiddle" title="{$pay['pay_name']}"   alt='{$pay['pay_name']}'></label>
		                          </div>
							   {/if} 
		                    {/loop}
							{if $k==0}
							   <div>{$_lang['online_pay']}{$_lang['account_close']}{$_lang['contact_admin']}</div>
							 {/if} 
		                 </fieldset>
		               </div>
					{if $k>0}
		            <div class="rowElem clearfix t_c">
		               <input type="hidden" name="sbt_pay" value="1">
		                   <button type="button" value={$_lang['pay']} style="width:100px" onclick="user_pay();">{$_lang['pay']}</button>
		            </div>
					{/if}
		            </div>
					<!--end 线上支付方式-->
					<!--start 线下支付方式-->
		            <div class="suffix_1 offline hidden" id="div_cont_2">
		               <div class="messages m_infor clearfix">
		                  <span class="icon16  fl_l">info</span><div class="grid_16">{$_K['website_name']}{$_lang['remit_notice']}</div>
		               </div>
		               <div class="mt_10 mb_10 font12 account1">
		                  <fieldset>
		                      <legend>{$_lang['optional_account']}</legend>
		                      <!--{eval $k=0;}-->
							  {loop $offline_pay_list $v}
							  <!--{eval $pay=unserialize($v['config'])}-->
							  	{if $pay['pay_status']}<!--{eval $k++;}-->
		                           <div class="grid_8">
		                              <div class="grid_8">
		                                 <input type="radio" name="offline" value="{$v['payment']}" {if $k=='1'}checked{/if}/><img src="resource/img/system/kppw_2.0_{$v['payment']}.png" alt="{$v['payment']}" title="{$v['payment']}">
		                              </div>
		                           	  <div class="grid_8">
		                                 <ul class="prefix_1">
		                                   <li>{$_lang['pay_name']}{$_lang['zh_mh']}{$pay['pay_name']} </li>
		                                   <li> {$_lang['choose_pay_account']}{$_lang['zh_mh']}{$pay['pay_account']}</li>
		                                   <li>{$_lang['pay_user']}{$_lang['zh_mh']}{$pay['pay_user']}</li>
		                                   <li>{$_lang['pay_phone']}{$_lang['zh_mh']}{$pay['pay_phone']}</li>
		                                 </ul>
		                               </div>
		                             </div>
		                          {/if} 
		                       {/loop} 
							   {if $k==0}
							   <div>{$_lang['offline_pay']}{$_lang['account_close']}{$_lang['contact_admin']}</div>
							   {/if}
		                     </fieldset>
		                   </div>
						   
					{if $k>0}
						   <div class="messages m_infor clearfix">
					 <span class="icon16 fl_l">info</span><div class="grid_16">{$_K['website_name']}{$_lang['audit_notice']}</div>
		               </div>
		               <div class="mt_10 mb_10 font12 account1">
		                  <fieldset>
		                  	<form name="pay_info_frm" id="pay_info_frm" method="post" action="#">
		                      <legend>{$_lang['recharge_info']}</legend>
		                   		<span class="fl_l">{$_lang['recharge_info']}{$_lang['zh_mh']}</span>
								
								<textarea name="pay_info" id="pay_info" style="width:500px;height:70px"></textarea>
							 </form>
							 </fieldset>
		                   </div>
						    {/if}
						{if $k>0}
			            <div class="rowElem clearfix t_c">
			               <input type="hidden" name="sbt_pay" value="1">
			                   <button type="button" value={$_lang['pay']} style="width:100px" onclick="user_pay();">{$_lang['pay']}</button>
			            </div>
						{/if}
		                 </div>
					<!--end 线下支付方式-->
		         
		        </form>
		       </div>
		       <div class="clear"></div>
		      {elseif $step=='step3'}
		       <div class="box complete form_box ml_40 mr_40">
		          <div class="form_tip cc00"> {$_lang['recharge_apply_submit_success']}</div>
		          <div class="prefix_4 suffix_4">
		            <div class="completedata">
		               <ul>
		                  <li>
		                    <div class="pad10">
		                      <div class="grid_2"><!--{userpic($uid,'small')}--></div>
		                      <div class=" grid_6 ">
		                          <div class="font14b c690">{$_lang['recharge_money']}:{$cash}{$_lang['yuan']}</div>
		                      </div>
		                       <div class="clear"></div>
		                    </div>
		                  </li>
		                  <li>
		                      <div class="pad10">
		                        <div class=" grid_2">&nbsp;</div>
		                        <div class="grid_6">
		                        	<div>
		                                                                                {$_lang['recharge_record_save']}
			                           <p>
			                           	<a href="index.php?do=user&view=finance&op=detail&action=charge#userCenter" target="_blank">{$_lang['view_recharge_record']}&gt;&gt;</a>
			                           </p>
		                         </div>
		                         </div>
		                         <div class="clear"></div>
		                      </div>
		                   </li>
		                </ul>
		              </div>
		           </div>
		         </div>
		      {/if}
		    </div>
		    <div class="clear"></div>
		  </article>
		  <!--detail内容 end-->
 
 	</div>
	  <!--main content end -->
	  <div class="clear"></div>
	  </div>
	</div>
    <!--main end-->
	</div>
 </section>
</div>
</div>
<!--contain end-->
<script type="text/javascript">
	In('form');
 $(function(){
      var uid = parseInt("{$uid}") + 0;
	  
      $("button[name='btn_pay']").click(function(){
        var pay_m = $('input[name="rdo_pay"]:checked').val();
           if ($("#recharge").val() < $pay_arr['recharge_min']['v']) {
                 showDialog("{$_lang['recharge_money_not_less']}"+"{$pay_arr['recharge_min']['v']}"+'{$_lang['yuan']}'+"{$_lang['zh_th']}", 'alert', "{$_lang['error_tips']}");
                 document.getElementById("recharge").focus();
             } else 
                 if ($("#recharge").val() > 0) {
                 }else {
                     document.getElementById("recharge").focus();
                     showDialog("{$_lang['money_input_error']}", 'alert', "{$_lang['error_tip']}");
                 }
        })
  })
  function next_step(){
	
  	  if(checkForm(document.getElementById("frm_cash"),false)){
	 
	      var charge_cash = Number($("#recharge").val())+Number(0);
		  $("#cash").val(charge_cash);
	
	      var min_charge = parseFloat($pay_arr['recharge_min']['v']) + 0;
	           
	       if (charge_cash >= min_charge) {
	     		$("#frm_cash").submit();
	       }
	       else {
	           document.getElementById("recharge").focus();
			   return false;
	       }
		   return true;
	  } 
  	return false;
  }              
function user_pay(){
	 var paymode = 'online';
	 var pay_info = $("#pay_info").val();
	 
     if($("div#div_cont_2").hasClass("block")){
		paymode  = 'offline';
	 }
      var cash = parseFloat($cash) + 0;
      switch (paymode) {
          case "online": 
             var pay_mode = $(":radio[name='online']:checked").val(); 
			 		pay(pay_mode,cash);
             break;
          case "offline":
             var pay_account = $(":radio[name='offline']:checked").val();
			 pay_info =escape(pay_info);
		
			 var url         = "$ac_url&step=step2&pay_type=offline_charge&cash=" + cash + "&pay_account=" + pay_account+"&pay_info="+pay_info; 	
		 
	         showDialog("{$_lang['you_choose_us']}【"+pay_account+"】{$_lang['offline_recharge_confirm_submit']}","confirm","{$_lang['recharge_tip']}",'location.href="'+url+'"');return false;
            break;
      }
}
function pay(pay_mode,cash){

	var url = '$ac_url&step=step2&pay_type=online_charge&ajax=confirm&cash=' + cash + '&pay_mode=' + pay_mode;
 
		showWindow("pay",url,'get',0,{cover:1});return false;
} 
  </script>
<!--{template user/user_footer}-->  
<!--{template footer}-->
